---
title: "Trabalho final"
author: "Grupo 7"
date: "19/07/2020"
output: github_document
---
### Introdução

## A base de dados escolhida para a realização da análise exploratória referente ao Trabaho final dessa discplina foi sobre os Repasses a municípios e pode ser acessada nessa [página](http://www.transparencia.dadosabertos.mg.gov.br/dataset/repasse-a-municipios-2015-2016)

Essa base de dado possui as seguintes informações: dados sobre repasse do Estado aos municípios em relação aos tributos ICMS, IPI e IPVA. Trata-se do repasse líquido, a que cada município tem direito descontando-se outras contribuições legais e constitucionais de cada um. Retrata o repasse publicado em portarias mensais da Secretaria de Estado da Fazenda.

Na primeira fase do trabaçho final deve ser feita a importação da base que será utilziada e as perguntas que nortearão a análise exporatória.

### Perguntas

1. Quais são os 10 municípios que recebem a maior porcentagem de repasses do **ICMS**?
2. Quais são os 10 municípios que recebem a maior porcentagem de repasses do **IPI**?
3. Quais são os 10 municípios que recebem a maior porcentagem de repasses do **IPVA**?
4. Quais são os valores absolutos referentes aos 10 maiores repasses de **ICMS** e quais são elas?
5. Quais são os valores absolutos referentes aos 10 maiores repasses de **IPI** e quais são elas?
6. Quais são os valores absolutos referentes aos 10 maiores repasses de **IPVA** e quais são elas?
7. Quais são os 5 municípios que recebem o **maior** repasse total (ICMS+IPI+IPVA)?
8. Quais são os 5 municípios que recebem o **menor** repasse total (ICMS+IPI+IPVA)?
9. Quanto foi o repasse total de ICMS em cada **mês de 2016**?
10. Quanto foi o repasse total de IPI em cada **mês de 2016**?
11. Quanto foi o repasse total de IPVA em cada **mês de 2016**?
```{r, setup, include=FALSE}
library(readr); library(readxl); library(ggplot2); library(tidyverse); library(magrittr); library(data.table)


rm_accent <- function(str,pattern="all") {
  if(!is.character(str))
    str <- as.character(str)
  pattern <- unique(pattern)
  if(any(pattern=="Ç"))
    pattern[pattern=="Ç"] <- "ç"
  symbols <- c(
    acute = "áéíóúÁÉÍÓÚýÝ",
    grave = "àèìòùÀÈÌÒÙ",
    circunflex = "âêîôûÂÊÎÔÛ",
    tilde = "ãõÃÕñÑ",
    umlaut = "äëïöüÄËÏÖÜÿ",
    cedil = "çÇ"
  )
  nudeSymbols <- c(
    acute = "aeiouAEIOUyY",
    grave = "aeiouAEIOU",
    circunflex = "aeiouAEIOU",
    tilde = "aoAOnN",
    umlaut = "aeiouAEIOUy",
    cedil = "cC"
  )
  accentTypes <- c("´","`","^","~","¨","ç")
  if(any(c("all","al","a","todos","t","to","tod","todo")%in%pattern)) # opcao retirar todos
    return(chartr(paste(symbols, collapse=""), paste(nudeSymbols, collapse=""), str))
  for(i in which(accentTypes%in%pattern))
    str <- chartr(symbols[i],nudeSymbols[i], str)
  return(str)
}

base <- read_excel("data-raw/ftrepassemun2016.xlsx")

base_mes <- read_excel("data-raw/dmtempomensal2016.xlsx")

base_municipio <- read_excel("data-raw/dmmunicipio2016.xlsx")

municipio_sem_acento <- rm_accent(base_municipio$NOME)

base_municipio[3] <- municipio_sem_acento


```
```{r}
library(readr); library(readxl); library(ggplot2); library(tidyverse)

base <- readxl::read_xlsx("data-raw/ftrepassemun2016.xlsx")

base_tempo_mensal <- readxl::read_xlsx("data-raw/dmtempomensal2016.xlsx")

base_municipio <- readxl::read_xlsx("data-raw/dmmunicipio2016.xlsx")

ID <- left_join(base_municipio, base, by = "ID_MUNICIPIO")

ID %>%
  group_by(NOME) %>%
  summarize(TOTAL_ICMS = sum(VR_ICMS)) %>%
  mutate(PORCENTAGEM_ICMS = TOTAL_ICMS/sum(TOTAL_ICMS)) %>%
  arrange(desc(PORCENTAGEM_ICMS)) %>%
  filter(PORCENTAGEM_ICMS >= 0.0139) %>%
  ggplot()+
  geom_col(aes(x = NOME, y = PORCENTAGEM_ICMS)) +
  labs(title = "10 municípios que recebem a maior porcentagem de ICMS") +
  xlab("Município") + ylab("Porcentagem ICMS")
```

2. Quais são os 10 municípios que recebem a maior porcentagem de repasses do **IPI**?

```{r}
ID %>%
  group_by(NOME) %>%
  summarize(TOTAL_IPI = sum(VR_IPI)) %>%
  mutate(PORCENTAGEM_IPI = TOTAL_IPI/sum(TOTAL_IPI)) %>%
  arrange(desc(PORCENTAGEM_IPI)) %>%
  filter(PORCENTAGEM_IPI >= 0.0139) %>%
  ggplot()+
  geom_col(aes(x = NOME, y = PORCENTAGEM_IPI)) +
  labs(title = "10 municípios que recebem a maior porcentagem de IPI") +
  xlab("Município") + ylab("Porcentagem IPI")
```

3. Quais são os 10 municípios que recebem a maior porcentagem de repasses do **IPVA**?
```{r}
ID %>%
  group_by(NOME) %>%
  summarize(TOTAL_IPVA = sum(VR_IPVA)) %>%
  mutate(PORCENTAGEM_IPVA = TOTAL_IPVA/sum(TOTAL_IPVA)) %>%
  arrange(desc(PORCENTAGEM_IPVA)) %>%
  filter(PORCENTAGEM_IPVA >= 0.0125) %>%
  ggplot()+
  geom_col(aes(x = NOME, y = PORCENTAGEM_IPVA)) +
  labs(title = "10 municípios que recebem a maior porcentagem de IPVA") +
  xlab("Município") + ylab("Porcentagem IPVA")   
```

